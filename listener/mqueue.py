import os
import json
import logging
import datetime
from kafka import KafkaConsumer, KafkaProducer

BOOTSTRAP_SERVERS = 'kafka:9092'
ENGINE_RESULTS_TOPIC = 'vulnerability_results'  # the topic to subscribe to for engine results'

logging.basicConfig(level=logging.INFO)

class QWriter(KafkaProducer):
    def __init__(self, topic=ENGINE_RESULTS_TOPIC, bootstrap_servers=BOOTSTRAP_SERVERS, **kwargs):
        super(QWriter, self).__init__(bootstrap_servers=bootstrap_servers, **kwargs)
        self.results_topic = topic
        logging.info("Created message producer:")
        logging.info("Using BOOTSTRAP_SERVERS: %s", bootstrap_servers)
        logging.info("Using ENGINE_RESULTS_TOPIC: %s", self.results_topic)

    def send(self, msg):
        data = json.dumps(msg).encode("utf8")
        super(QWriter, self).send(self.results_topic, bytes(data))
